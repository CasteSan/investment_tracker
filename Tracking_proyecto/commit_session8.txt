# =============================================================================
# COMMIT MESSAGE - SESIÃ“N 8: Mejoras Benchmarks y Correcciones app
# =============================================================================
# Ejecutar: git add . && git commit -F Tracking_proyecto\commit_session8.txt
# =============================================================================

feat: Precios de mercado reales, traspasos fiscales y correcciones mÃºltiples

MEJORAS PRINCIPALES:

1. SISTEMA DE PRECIOS DE MERCADO REALES
   - Nuevo mÃ³dulo src/market_data.py para descargar precios histÃ³ricos
   - Nueva tabla asset_prices en database.py
   - Dashboard y AnÃ¡lisis ahora usan precios de mercado descargados
   - MÃ©todo get_all_latest_prices() para obtener Ãºltimos precios
   
2. BENCHMARKS CON VALOR REAL DE CARTERA
   - GrÃ¡fico estilo Investing.com con valor real en â‚¬
   - Tres lÃ­neas: Valor Total, Posiciones Abiertas, Capital Invertido
   - ComparaciÃ³n Base 100 usando rendimiento sobre coste (no valor absoluto)
   - Dos modos: Solo posiciones actuales vs Cartera completa
   - Fix: Las aportaciones ya no afectan el grÃ¡fico de comparaciÃ³n
   
3. TRASPASOS FISCALES CORREGIDOS
   - Traspasos entre fondos ahora mantienen coste fiscal (ley espaÃ±ola)
   - Nuevos campos en Transaction: cost_basis_eur, transfer_link_id
   - tax_calculator.py actualizado para manejar transfer_in/transfer_out
   - Formulario de traspaso mejorado con campo de coste fiscal
   
4. CORRECCIONES DE ERRORES
   - Fix: Slider en AnÃ¡lisis con pocas posiciones (min_value > max_value)
   - Fix: Error de Ã­ndices en Benchmarks al comparar series
   - Fix: get_fiscal_detail â†’ get_fiscal_year_detail en Fiscal.py
   - Fix: check_wash_sale_rule â†’ get_wash_sales_in_year en Fiscal.py
   - Fix: Ganancia latente = 0 cuando no hay precios descargados

ARCHIVOS MODIFICADOS:
- src/database.py (AssetPrice model, mÃ©todos de precios)
- src/market_data.py (NUEVO - gestiÃ³n precios de mercado)
- src/benchmarks.py (valor real, rendimiento sobre coste)
- src/tax_calculator.py (traspasos fiscales)
- src/portfolio.py (traspasos fiscales)
- app/pages/1_ðŸ“Š_Dashboard.py (precios de mercado)
- app/pages/2_âž•_AÃ±adir_OperaciÃ³n.py (formulario traspasos)
- app/pages/3_ðŸ“ˆ_AnÃ¡lisis.py (precios mercado, slider fix)
- app/pages/4_ðŸ’°_Fiscal.py (correcciÃ³n mÃ©todos)
- app/pages/6_ðŸŽ¯_Benchmarks.py (reescrito completo)

NOTAS:
- Requiere ejecutar ALTER TABLE para aÃ±adir columnas si BD existente
- Los precios se descargan desde Yahoo Finance (yfinance)
- Compatible con legislaciÃ³n fiscal espaÃ±ola para traspasos
